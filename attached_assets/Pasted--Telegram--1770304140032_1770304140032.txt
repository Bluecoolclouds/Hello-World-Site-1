Ты — опытный разработчик Telegram‑ботов знакомств. Нужно изменить логику подбора анкет по возрасту.

Текущая проблема: бот показывает только пользователей того же возраста, что и текущий пользователь (фильтр по точному совпадению возраста). Нужно, чтобы бот показывал всех подходящих пользователей, но начинал с самых близких по возрасту и дальше постепенно увеличивал возрастной разброс.

Требования к новой логике:

Убери фильтр вида WHERE age = current_user.age или любую жёсткую проверку на равенство возраста. Вместо этого выбери всех пользователей нужного пола и других параметров (город, активность, статус и т.п.).

Добавь в запрос сортировку по близости возраста к текущему пользователю: сначала пользователи с минимальной разницей в возрасте, затем с большей. Для этого используй выражение ABS(age - :current_age) в секции ORDER BY.

Пример желаемого SQL‑запроса:

sql
SELECT *
FROM users
WHERE id != :current_user_id
  AND gender = :preferred_gender
  -- при необходимости: AND age BETWEEN :min_pref_age AND :max_pref_age
ORDER BY ABS(age - :current_age) ASC,
         last_active DESC;
Здесь :current_age — возраст текущего пользователя. Сначала должны идти почти ровесники, затем пользователи с разницей 1–2 года, потом 3–5 и т.д.

Бот должен показывать анкеты последовательно в этом порядке: сначала ближайшие по возрасту, но при пролистывании пользователь может дойти до всех остальных анкет, пока список не закончится. Не обрезай выдачу только ровесниками.

Сделай так, чтобы в будущем можно было легко добавить настройки возрастных предпочтений пользователя (минимальный и максимальный возраст партнёра), не ломая общий принцип сортировки по ABS(age - current_age). То есть логика такая: сначала фильтр по возрастному диапазону (если он указан), затем сортировка по близости возраста.

Обнови все места в коде (или в логике ИИ‑функций), где сейчас используется жёсткая проверка возраста, чтобы везде работала новая система рекомендаций с приоритетом ближайших возрастов.

Верни обновлённый код/логику, чётко показав изменённые SQL‑запросы или функции, которые формируют список кандидатов, и поясни, как теперь происходит сортировка по возрасту.

